<Window x:Class="CMMDemoApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:CMMDemoApp"
        xmlns:helix="http://helix-toolkit.org/wpf/SharpDX"
        mc:Ignorable="d"
        Title="KMM Demo App" Height="700" Width="1200"
        DataContext="{Binding Main, Source={StaticResource Locator}}">
  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="200"/>
      <ColumnDefinition Width="*"/>
      <ColumnDefinition Width="320"/>
    </Grid.ColumnDefinitions>

    <!-- Bedienfeld -->
    <StackPanel Grid.Column="0" Margin="10" VerticalAlignment="Top">
      <Button Content="📂 STL Laden" Margin="0 5" Command="{Binding LoadModelCommand}" />
      <Button Content="▶ Messung starten" Margin="0 5" Command="{Binding StartMeasurementCommand}" />
      <Button Content="📝 Bericht exportieren" Margin="0 5" Command="{Binding ExportReportCommand}" />
    </StackPanel>

    <!-- 3D Viewport -->
    <helix:Viewport3DX Grid.Column="1" x:Name="Viewport" 
                       BackgroundColor="LightGray" 
                       Camera="{Binding Camera}"
                       EffectsManager="{Binding EffectsManager}">
      
      <!-- Beleuchtung -->
      <helix:DirectionalLight3D Direction="-1,-1,-1" Color="White"/>
      <helix:AmbientLight3D Color="#404040"/>
      
      <!-- Koordinatengitter -->
      <helix:LineGeometryModel3D x:Name="GridLines" Geometry="{Binding GridLinesGeometry}" Color="Gray" Thickness="1"/>
      
      <!-- Modell wird programmatisch geladen -->
      <helix:MeshGeometryModel3D x:Name="LoadedModel" 
                                 Geometry="{Binding ModelGeometry}" 
                                 Material="{Binding ModelMaterial}"/>
      
      <!-- KMM-Tastkopf -->
      <helix:MeshGeometryModel3D x:Name="Probe" 
                                 Geometry="{Binding ProbeGeometry}" 
                                 Material="{Binding ProbeMaterial}"
                                 Transform="{Binding ProbeTransform}"/>
      
    </helix:Viewport3DX>

    <!-- Tabellen und Infos -->
    <StackPanel Grid.Column="2" Margin="10" VerticalAlignment="Stretch">
      <TextBlock Text="📊 Gemessene Punkte" FontWeight="Bold" Margin="0 0 0 5"/>
      <DataGrid ItemsSource="{Binding MeasurementResults}" AutoGenerateColumns="False" Height="200">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Name" Binding="{Binding Name}"/>
          <DataGridTextColumn Header="Sollwert" Binding="{Binding Nominal}"/>
          <DataGridTextColumn Header="Istwert" Binding="{Binding Actual}"/>
          <DataGridTextColumn Header="Abweichung" Binding="{Binding Deviation}"/>
        </DataGrid.Columns>
      </DataGrid>

      <TextBlock Text="📌 Details" FontWeight="Bold" Margin="0 10 0 5"/>
      <TextBlock Text="{Binding SelectedPointInfo}" TextWrapping="Wrap"/>
    </StackPanel>
  </Grid>
</Window>
